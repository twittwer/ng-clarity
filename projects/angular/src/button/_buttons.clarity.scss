/*
 * Copyright (c) 2016-2023 VMware, Inc. All Rights Reserved.
 * This software is released under MIT license.
 * The full license information can be found in LICENSE in the root directory of this project.
 */
@use 'sass:meta';
@use '../utils/mixins';
@use '../utils/variables/variables';
@use 'variables.buttons' as buttons-variables;
@use '@cds/core/tokens/tokens.scss';

@mixin button-css-var($button-type: default, $style: null, $styleNickname: $style) {
  @if $style {
    #{$style}: var(#{'--clr-btn-' + $button-type + '-' + $styleNickname});
  }
}

@mixin populateButtonProperties($button-type: default) {
  @include button-css-var($button-type, border-color);
  @include button-css-var($button-type, background-color, bg-color);
  @include button-css-var($button-type, color);

  cds-icon,
  clr-icon {
    @include button-css-var($button-type, color);
  }

  &:hover {
    @include button-css-var($button-type, background-color, hover-bg-color);
    @include button-css-var($button-type, color, hover-color);
    cds-icon,
    clr-icon {
      @include button-css-var($button-type, color, hover-color);
    }
  }

  &:active {
    @include button-css-var($button-type, background-color, active-bg-color);
    @include button-css-var($button-type, color, active-color);
    cds-icon,
    clr-icon {
      @include button-css-var($button-type, color, active-color);
    }
  }

  &.disabled,
  &:disabled {
    @include button-css-var($button-type, color, disabled-color);
    cursor: not-allowed;
    @include button-css-var($button-type, background-color, disabled-bg-color);
    @include button-css-var($button-type, border-color, disabled-border-color);
  }
}

@mixin btn-checked-styles($button-type: default, $type: checkbox) {
  // add semantic prop: group-checked-font-color
  input[type='#{$type}']:checked + label,
  // override icon colors on inverted backgrounds
  input[type='#{$type}']:checked + label > clr-icon,
  input[type='#{$type}']:checked + label > cds-icon {
    @include button-css-var($button-type, background-color, checked-bg-color);
    @include button-css-var($button-type, color, checked-color);
  }
}

@mixin btn-nowrap() {
  white-space: nowrap;
  text-overflow: ellipsis;
  overflow: hidden;
}

@mixin btn-min-max-widths() {
  min-width: variables.$clr_baselineRem_3;
  max-width: variables.$clr_baselineRem_15;
}

@mixin btn-text-properties() {
  text-align: center;
  text-decoration: none;
  vertical-align: middle;

  &:hover {
    text-decoration: none;
  }
}

@mixin btn-default-border-styles() {
  border-radius: var(--clr-btn-border-radius);
  border-width: var(--clr-btn-border-width);
  border-style: solid;
}

@mixin btn-appearance() {
  cursor: pointer;

  display: inline-flex;
  gap: #{tokens.$cds-global-space-5};
  align-items: center;
  place-content: center;

  // Overrides a Fix for IOS in BS4 _normalize.scss (~ln 330)
  // `!important` is to override specificity in this instance
  // But we wanted to preserve the normalize fix in non-Clarity buttons for iOS
  -webkit-appearance: none !important;
}

@mixin btn-sm-appearance() {
  @include mixins.generate-typography-token('BUTTON-11-SMALL');

  height: var(--clr-btn-appearance-standard-height);
  padding: var(--clr-btn-appearance-standard-padding);
}

@mixin generateButton() {
  @include btn-appearance();
  @include btn-default-border-styles();
  @include btn-min-max-widths();
  @include btn-nowrap();
  @include btn-text-properties();
}

@include meta.load-css('properties.buttons');

@include mixins.exports('buttons.clarity') {
  .btn {
    @include generateButton();
    @include populateButtonProperties(default);
    @include mixins.generate-typography-token('BUTTON-12');

    height: var(--clr-btn-appearance-form-height);
    padding: var(--clr-btn-appearance-form-padding);
  }

  //Clarity Buttons
  .btn-group > .btn,
  .btn {
    clr-icon {
      transform: translate3d(0, -1 * variables.$clr_baselineRem_2px, 0);
    }
  }

  //.btn-outline-<state> is the new BS4 naming convention. We are using both for now
  // TODO: Refactor these classnames when the standard clarity naming convention is set.
  // This is a breaking change and will need an upgrade path so users know how to easily migrate to the new
  // version.
  a.btn,
  .btn.btn-secondary,
  .btn-secondary .btn {
    @include populateButtonProperties(default);
  }

  .btn.btn-info,
  .btn-info .btn,
  .btn.btn-primary,
  .btn-primary .btn {
    @include populateButtonProperties(primary);
  }

  .btn.btn-success,
  .btn-success .btn {
    @include populateButtonProperties(success);
  }
  .btn.btn-warning,
  .btn-warning .btn {
    @include populateButtonProperties(warning);
  }

  .btn.btn-danger,
  .btn-danger .btn {
    @include populateButtonProperties(danger);
  }

  .btn.btn-neutral,
  .btn-neutral .btn {
    @include populateButtonProperties(neutral);
  }

  .btn.btn-outline,
  .btn.btn-outline .btn,
  .btn.btn-secondary-outline,
  .btn.btn-outline-secondary,
  .btn-secondary-outline .btn,
  .btn-outline-secondary .btn,
  .btn-outline .btn {
    @include populateButtonProperties(default-outline);
  }

  .btn.btn-primary-outline,
  .btn-outline-info .btn,
  .btn-info-outline .btn,
  .btn-primary-outline .btn,
  .btn-outline-primary .btn,
  .btn.btn-outline-primary,
  .btn.btn-outline-info,
  .btn.btn-info-outline,
  .btn.btn-info-outline {
    @include populateButtonProperties(primary-outline);
  }

  .btn.btn-success-outline,
  .btn.btn-outline-success,
  .btn-success-outline .btn,
  .btn-outline-success .btn {
    @include populateButtonProperties(success-outline);
  }
  .btn.btn-warning-outline,
  .btn.btn-outline-warning,
  .btn-warning-outline .btn,
  .btn-outline-warning .btn {
    @include populateButtonProperties(warning-outline);
  }

  .btn.btn-danger-outline,
  .btn.btn-outline-danger,
  .btn-danger-outline .btn,
  .btn-outline-danger .btn {
    @include populateButtonProperties(danger-outline);
  }

  .btn.btn-neutral-outline,
  .btn.btn-outline-neutral,
  .btn-neutral-outline .btn,
  .btn-outline-neutral .btn {
    @include populateButtonProperties(neutral-outline);
  }

  .btn.btn-link,
  .btn-link .btn {
    @include populateButtonProperties(link);

    //To override the visited state of anchor links styled as buttons
    &:visited {
      @include button-css-var(link, color, visited-color);
      cds-icon,
      clr-icon {
        @include button-css-var(link, color, visited-color);
      }
      &:hover {
        @include button-css-var(link, color, visited-hover-color);
        cds-icon,
        clr-icon {
          @include button-css-var(link, color, visited-hover-color);
        }
      }
    }
  }

  .btn.btn-link-primary,
  .btn-link-primary .btn {
    @include populateButtonProperties(link-primary);
  }

  .btn.btn-link-success,
  .btn-link-success .btn {
    @include populateButtonProperties(link-success);
  }

  .btn.btn-link-warning,
  .btn-link-warning .btn {
    @include populateButtonProperties(link-warning);
  }

  .btn.btn-link-danger,
  .btn-link-danger .btn {
    @include populateButtonProperties(link-danger);
  }

  .btn.btn-link-neutral,
  .btn-link-neutral .btn {
    @include populateButtonProperties(link-neutral);
  }

  .btn.btn-inverse,
  .btn-inverse .btn {
    @include populateButtonProperties(inverse);
  }

  .btn.btn-sm,
  .btn-sm .btn {
    @include btn-sm-appearance();
  }

  .btn-block {
    display: flex;
    width: 100%;
    max-width: 100%;
  }

  .btn {
    margin: var(--clr-btn-vertical-margin) var(--clr-btn-horizontal-margin) var(--clr-btn-vertical-margin) 0;

    &.btn-link {
      margin-right: 0;
    }

    &.btn-link.btn-inverse {
      border-color: transparent;
    }
  }

  //Small Icon Button
  .btn-sm:not(.btn-link) {
    clr-icon {
      @include mixins.css-var(
        width,
        clr-btn-appearance-standard-icon-size,
        variables.$clr_baselineRem_0_5,
        variables.$clr-use-custom-properties
      );
      @include mixins.css-var(
        height,
        clr-btn-appearance-standard-icon-size,
        variables.$clr_baselineRem_0_5,
        variables.$clr-use-custom-properties
      );
      transform: translate3d(0, -1 * variables.$clr_baselineRem_1px, 0);
    }
    cds-icon {
      @include mixins.css-var(
        width,
        clr-btn-appearance-standard-icon-size,
        variables.$clr_baselineRem_0_5,
        variables.$clr-use-custom-properties
      );
      @include mixins.css-var(
        height,
        clr-btn-appearance-standard-icon-size,
        variables.$clr_baselineRem_0_5,
        variables.$clr-use-custom-properties
      );
    }
  }

  .btn-icon {
    min-width: 0;
  }

  .btn.disabled,
  .btn:disabled {
    cds-icon,
    clr-icon {
      @include mixins.css-var(
        color,
        clr-btn-icon-disabled-color,
        variables.$clr-color-neutral-400,
        variables.$clr-use-custom-properties
      );
    }
  }

  //Overflow
  .btn-group {
    &.btn-primary .dropdown-toggle,
    &.btn-success .dropdown-toggle,
    &.btn-warning .dropdown-toggle,
    &.btn-danger .dropdown-toggle {
      @include populateButtonProperties(primary);
    }
    &.btn-danger :disabled {
      @include mixins.css-var(
        border-color,
        clr-color-neutral-400,
        variables.$clr-color-neutral-400,
        variables.$clr-use-custom-properties
      );
    }

    &.btn-link .dropdown-toggle {
      @include populateButtonProperties(link);
    }

    &.btn-sm .btn-group-overflow > .dropdown-toggle {
      @include btn-sm-appearance();
    }
  }

  //Checkboxes styled as Buttons
  //Radio Buttons styled as Buttons
  .checkbox.btn,
  .checkbox-inline.btn,
  .radio.btn,
  .radio-inline.btn {
    padding: 0;

    label {
      display: block;
      line-height: inherit;
      padding: 0 variables.$clr_baselineRem_0_5;
      cursor: pointer;
    }
  }

  .checkbox.btn,
  .checkbox-inline.btn {
    input[type='checkbox'] + label::before,
    input[type='checkbox'] + label::after {
      content: none;
    }
  }

  .radio.btn,
  .radio-inline.btn {
    input[type='radio'] + label::before,
    input[type='radio'] + label::after {
      content: none;
    }
  }

  .checkbox.btn,
  .checkbox-inline.btn {
    @include btn-checked-styles();

    label {
      width: 100%;
    }

    //.btn-outline-<state> is the new BS4 naming convention
    //TODO: we support both the previous one and the new one but we will deprecate the old ones from the example in 0.5.0
    &.btn-secondary,
    &.btn-info,
    &.btn-outline,
    &.btn-primary-outline,
    &.btn-secondary-outline,
    &.btn-outline-primary,
    &.btn-outline-secondary,
    &.btn-info-outline,
    &.btn-outline-info {
      @include btn-checked-styles();
    }

    &.btn-primary {
      @include btn-checked-styles(primary);
    }

    &.btn-success {
      @include btn-checked-styles(success);
    }

    &.btn-warning {
      @include btn-checked-styles(warning);
    }

    &.btn-danger {
      @include btn-checked-styles(danger);
    }

    &.btn-success-outline,
    &.btn-outline-success {
      @include btn-checked-styles(outline-success);
    }

    &.btn-danger-outline,
    &.btn-outline-danger {
      @include btn-checked-styles(outline-danger);
    }

    &.btn-warning-outline,
    &.btn-outline-warning {
      @include btn-checked-styles(outline-warning);
    }

    &.btn-link {
      @include btn-checked-styles(link);
    }

    &.btn-inverse {
      @include btn-checked-styles(inverse);
    }
  }

  .radio.btn,
  .radio.btn {
    @include btn-checked-styles(default, radio);

    label {
      width: 100%;
    }

    //.btn-outline-<state> is the new BS4 naming convention. We are using both for now
    // TODO: Refactor these classnames when the standard clarity naming convention is set.
    // This is a breaking change and will need an upgrade path so users know how to easily migrate to the new
    // version.
    &.btn-secondary,
    &.btn-info,
    &.btn-outline,
    &.btn-primary-outline,
    &.btn-secondary-outline,
    &.btn-outline-primary,
    &.btn-outline-secondary,
    &.btn-info-outline,
    &.btn-outline-info {
      @include btn-checked-styles(default, radio);
    }

    &.btn-primary {
      @include btn-checked-styles(primary, radio);
    }

    &.btn-success {
      @include btn-checked-styles(success, radio);
    }

    &.btn-warning {
      @include btn-checked-styles(warning, radio);
    }

    &.btn-danger {
      @include btn-checked-styles(danger, radio);
    }

    &.btn-success-outline,
    &.btn-outline-success {
      @include btn-checked-styles(success-outline, radio);
    }

    &.btn-warning-outline,
    &.btn-outline-warning {
      @include btn-checked-styles(warning-outline, radio);
    }

    &.btn-danger-outline,
    &.btn-outline-danger {
      @include btn-checked-styles(danger-outline, radio);
    }

    &.btn-link {
      @include btn-checked-styles(link, radio);
    }

    &.btn-inverse {
      @include btn-checked-styles(inverse, radio);
    }
  }
}
